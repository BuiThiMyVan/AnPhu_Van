@model PageInfo<Users>
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Auth/Views/Shared/_LayoutAuth.cshtml";
}

@section StyleSheet {
    <style>
        .header-admin {
            margin: 0 8px;
            margin-bottom: 12px;
            font-size: 24px;
            font-weight: lighter;
            color: #2679b5;
            border-bottom: 1px dotted #e2e2e2;
            padding-bottom: 16px;
            padding-top: 7px;
        }

        .header-table {
            padding: 12px;
            background-color: #EFF3F8;
            display: flex;
            justify-content: space-between;
        }

        .paginate {
            display: flex;
            justify-content: space-between;
            background-color: #EFF3F8;
            padding: 20px;
        }

        .dataTables_wrapper .row:last-child, .dataTables_wrapper .row:first-child {
            display: none !important;
        }

        .table > thead > tr > th:last-child::after {
            display: none;
        }
    </style>

}

<div class="breadcrumbs ace-save-state" id="breadcrumbs">
    <ul class="breadcrumb">
        <li>
            <i class="ace-icon fa fa-home home-icon"></i>
            <a href="#">Home</a>
        </li>
        <li><a href="@Url.Action("Index", "Home")">Dashboard</a></li>
        <li><a href="@Url.Action("Index", "Users")">Danh sách người dùng</a></li>
    </ul>
</div>
<div class="main-container" id="main-container">
    <div class="header-admin">Danh sách người dùng</div>
    <div class="main-content">
        <div class="main-content-inner">
            <div class="page-content">
                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->
                        <div class="row">
                            <div class="col-xs-12">
                                <div>
                                    <div class="header-table">
                                        <div class="filter-select">
                                            <span>Display</span>
                                            <select id="pageSize" name="pageSize" onchange="updatePageSize()" value="@Model.PageSize">
                                                @foreach (var index in ViewBag.listPageSize)
                                                {
                                                    if (index == @Model.PageSize)
                                                    {
                                                        <option value="@index" selected>@index</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@index">@index</option>
                                                    }
                                                }
                                            </select>
                                            <span>records</span>
                                        </div>
                                        <div class="search-box">
                                            <span>Search:</span>
                                            <input type="text" id="txtSearch" name="name" onkeyup="search(event)" />
                                        </div>
                                    </div>
                                    <table id="dynamic-table" class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th class="center" style="display: none"></th>
                                                <th>Tên đăng nhập</th>
                                                <th>Nhóm quyền</th>

                                                <th>
                                                    <i class="ace-icon fa fa-clock-o bigger-110 hidden-480"></i>
                                                    Ngày tạo
                                                </th>
                                                <th class="hidden-480">Status</th>

                                                <th></th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            @foreach (Users item in Model.DataList)
                                            {
                                            <tr>
                                                <td class="center" style="display: none">
                                                    <label class="pos-rel">
                                                        <input type="checkbox" class="ace" />
                                                        <span class="lbl"></span>
                                                    </label>
                                                </td>

                                                <td>@item.UserName</td>
                                                <td class="hidden-480">@item.GroupRoleName</td>
                                                <td class="hidden-480">@item.CreateDate</td>
                                                <td class="hidden-480">
                                                    @if (item.IsActive == true)
                                                    {
                                                        <span class="label label-sm label-success">Is Active</span>

                                                    }
                                                    else
                                                    {
                                                        <span class="label label-sm label-danger">UnActive</span>

                                                    }
                                                </td>
                                                <td>
                                                    <div class="hidden-sm hidden-xs btn-group">
                                                        <button class="btn btn-xs btn-success" onclick="window.location.href='/vi/quan-tri/danh-sach-user/promote?userId=@item.UserId'">
                                                            <i class="ace-icon fa fa-arrow-circle-up bigger-120"></i>
                                                        </button>
                                                        <button class="btn btn-xs btn-warning" onclick="window.location.href='/vi/quan-tri/danh-sach-user/demote?userId=@item.UserId'">
                                                            <i class="ace-icon fa fa-arrow-circle-down bigger-120"></i>
                                                        </button>
                                                        <button class="btn btn-xs btn-info" href="@Url.Action("ChangePass","User")" data-toggle="modal" data-target="#ChangePassModal" data-username="@item.UserName">
                                                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                                                        </button>
                                                        @if (item.IsActive == true)
                                                        {
                                                            <button class="btn btn-xs btn-danger" onclick="window.location.href='/vi/quan-tri/danh-sach-user/xoa?userId=@item.UserId'">
                                                                <i class="ace-icon fa fa-unlock bigger-120"></i>
                                                            </button>
                                                        }
                                                        else
                                                        {
                                                            <button class="btn btn-xs btn-danger" onclick="window.location.href='/vi/quan-tri/danh-sach-user/active?userId=@item.UserId'">
                                                                <i class="ace-icon fa fa-lock bigger-120"></i>
                                                            </button>
                                                        }
                                                    </div>

                                                    <div class="hidden-md hidden-lg">
                                                        <div class="inline pos-rel">
                                                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown" data-position="auto">
                                                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                                                            </button>

                                                            <ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                                                <li>
                                                                    <a href="window.location.href='/vi/quan-tri/danh-sach-user/promote?userId=@item.UserId'" class="tooltip-success" data-rel="tooltip" title="Edit">
                                                                        <span class="green">
                                                                            <i class="ace-icon fa fa-arrow-circle-up bigger-120"></i>
                                                                        </span>
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a href="window.location.href='/vi/quan-tri/danh-sach-user/cap-nhat?demote=@item.UserId'" class="tooltip-success" data-rel="tooltip" title="Edit">
                                                                        <span class="green">
                                                                            <i class="ace-icon fa fa-arrow-circle-down bigger-120"></i>
                                                                        </span>
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a href="window.location.href='/vi/quan-tri/danh-sach-user/cap-nhat?userId=@item.UserId'" class="tooltip-success" data-rel="tooltip" title="Edit">
                                                                        <span class="green">
                                                                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                                                                        </span>
                                                                    </a>
                                                                </li>
                                                                @if (item.IsActive == true)
                                                                {
                                                                    <li>
                                                                        <a href="window.location.href='/vi/quan-tri/danh-sach-user/xoa?userId=@item.UserId'" class="tooltip-success" data-rel="tooltip" title="Edit">
                                                                            <span class="green">
                                                                                <i class="ace-icon fa fa-unlock bigger-120"></i>
                                                                            </span>
                                                                        </a>
                                                                    </li>
                                                                }
                                                                else
                                                                {
                                                                    <li>
                                                                        <a href="window.location.href='/vi/quan-tri/danh-sach-user/active?userId=@item.UserId'" class="tooltip-success" data-rel="tooltip" title="Edit">
                                                                            <span class="green">
                                                                                <i class="ace-icon fa fa-lock bigger-120"></i>
                                                                            </span>
                                                                        </a>
                                                                    </li>
                                                                }
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td style="display: none">Feb 12</td>
                                            </tr>
                                            }


                                        </tbody>
                                    </table>
                                    <div class="paginate no-margin-top">
                                        <div class="dataTables_info" id="dynamic-table_info" role="status" aria-live="polite">@ViewBag.pageView</div>

                                        <ul class="pagination pull-right no-margin" style="display: inline-block">
                                            <li class="prev">
                                                <a href="javascript:void(0);" onclick="prev()">
                                                    Previous
                                                </a>
                                            </li>
                                            @for (var i = 1; i < Model.PageCount; i++)
                                            {
                                                if (i == Model.PageIndex)
                                                {
                                                    <li class="active">
                                                        <a href="javascript:void(0);" onclick="goToPage(@i)">@i</a>
                                                    </li>
                                                }
                                                else
                                                {
                                                    <li>
                                                        <a href="javascript:void(0);" onclick="goToPage(@i)">@i</a>
                                                    </li>
                                                }
                                            }

                                            <li class="next">
                                                <a href="javascript:void(0);" onclick="next()">
                                                    Next
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.page-content -->
        </div>
    </div><!-- /.main-content -->
</div><!-- /.main-container -->
<div class="modal fade" id="ChangePassModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Reset password</h4>
            </div>
            <div class="modal-body">
                <form action="@Url.Action("ChangePass","Users")" method="post">
                    <input type="hidden" id="userName" name="userName" />
                    <div class="form-group">
                        <label for="password" class="control-label">Password:</label>
                        <input type="password" class="form-control" name="pass" id="pass" required>
                    </div>
                    <div class="form-group">
                        <label for="cfpassword" class="control-label">ConfirmPassword:</label>
                        <input type="password" class="form-control" name="cfNewPass" id="cfNewPass" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" id="btnSave">Save</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>
@section Scripts {

    <script type="text/javascript">
        $(document).ready(function () {
            jQuery(function ($) {
                //initiate dataTables plugin
                var oTable1 =
                    $('#dynamic-table')
                        .dataTable({
                            bAutoWidth: false,
                            "aoColumns": [
                                { "bSortable": false },
                                null, null, null, null, null,
                                { "bSortable": false }
                            ],
                            "aaSorting": [],

                        });
            })
        });

    </script>
    <script>
    var pageIndex = @Model.PageIndex;
    var pageSize = @Model.PageSize;

    function updatePageSize() {
        var pageSizeUpdate = $('#pageSize').val();
        debugger
        window.location.href = "/vi/quan-tri/danh-sach-user/danh-sach?page=" + pageIndex + "&pageSize=" + pageSizeUpdate;
        debugger
    }

    function search(e) {
        var txtSearch = $('#txtSearch').val().trim();
        if (e.key === 'Enter' || e.keyCode === 13) {
            window.location.href = "/vi/quan-tri/danh-sach-user/danh-sach?page=" + pageIndex + "&pageSize=" + pageSize + "&txtSearch=" + txtSearch;
        }

    }

    function prev() {
        if (pageIndex > 1) {
            pageIndex--;
            window.location.href = "/vi/quan-tri/danh-sach-user/danh-sach?page=" + pageIndex + "&pageSize=" + pageSize;
        }

    }

    function next() {
        if (pageIndex < @Model.PageCount) {
            pageIndex++;
            window.location.href = "/vi/quan-tri/danh-sach-user/danh-sach?page=" + pageIndex + "&pageSize=" + pageSize;
        }

    }

    function goToPage(index) {
        var txtSearch = $('#txtSearch').val().trim();
            window.location.href = "/vi/quan-tri/danh-sach-user/danh-sach?page=" + index + "&pageSize=" + pageSize + "&txtSearch=" + txtSearch;
        }

    $('#ChangePassModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        var recipient = button.data('username') // Extract info from data-* attributes
        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this)
        modal.find('.modal-title').text('ResetPassword for ' + recipient)
        modal.find('#userName').val(recipient)
    });

        $("#btnSave").click(function () {
            var pass = $("#pass").val();
            var cfpass = $("#cfNewPass").val();
            if (pass.length < 6) {
                alert("Password min length is 6 chars");
                return false;
            }
            if (cfpass != pass) {
                alert("Confirm password is wrong");
                return false;
            }
            return true;
        });
    </script>
}

